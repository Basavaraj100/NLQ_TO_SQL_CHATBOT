{"spans": [{"trace_id": "JYRozdlr1b9sOPkInAXMaA==", "span_id": "MuOCj/yM/I4=", "parent_span_id": null, "name": "LangGraph", "start_time_unix_nano": 1764584195013776400, "end_time_unix_nano": 1764584199831862000, "events": [{"name": "exception", "time_unix_nano": 1764584199831862, "attributes": {"exception.message": "'query_result'", "exception.type": "KeyError", "exception.stacktrace": "Traceback (most recent call last):\n  File \"c:\\Users\\HP\\anaconda3\\envs\\NLQ_TO_PYTHON_CHATBOT_ENV\\Lib\\site-packages\\langgraph\\pregel\\main.py\", line 2643, in stream\n    for _ in runner.tick(\n             ^^^^^^^^^^^^\n  File \"c:\\Users\\HP\\anaconda3\\envs\\NLQ_TO_PYTHON_CHATBOT_ENV\\Lib\\site-packages\\langgraph\\pregel\\_runner.py\", line 167, in tick\n    run_with_retry(\n  File \"c:\\Users\\HP\\anaconda3\\envs\\NLQ_TO_PYTHON_CHATBOT_ENV\\Lib\\site-packages\\langgraph\\pregel\\_retry.py\", line 42, in run_with_retry\n    return task.proc.invoke(task.input, config)\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"c:\\Users\\HP\\anaconda3\\envs\\NLQ_TO_PYTHON_CHATBOT_ENV\\Lib\\site-packages\\langgraph\\_internal\\_runnable.py\", line 656, in invoke\n    input = context.run(step.invoke, input, config, **kwargs)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"c:\\Users\\HP\\anaconda3\\envs\\NLQ_TO_PYTHON_CHATBOT_ENV\\Lib\\site-packages\\langgraph\\_internal\\_runnable.py\", line 400, in invoke\n    ret = self.func(*args, **kwargs)\n          ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\HP\\AppData\\Local\\Temp\\ipykernel_13412\\2051451323.py\", line 5, in format_final_answer\n    result = state['query_result']\n             ~~~~~^^^^^^^^^^^^^^^^\nKeyError: 'query_result'\nDuring task with name 'format_answer' and id '5b977954-c762-cd4e-af5a-660655e366d8'"}}], "status": {"code": "STATUS_CODE_ERROR", "message": "'query_result'"}, "attributes": {"mlflow.traceRequestId": "\"tr-258468cdd96bd5bf6c38f9089c05cc68\"", "mlflow.spanType": "\"CHAIN\"", "mlflow.spanInputs": "{\"messages\": [{\"content\": \"what are the different cources  available\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"human\", \"name\": null, \"id\": null}]}", "metadata": "{\"thread_id\": \"d2c030f9\"}"}}, {"trace_id": "JYRozdlr1b9sOPkInAXMaA==", "span_id": "DcbekDcNDkY=", "parent_span_id": "MuOCj/yM/I4=", "name": "check_intent", "start_time_unix_nano": 1764584195074858400, "end_time_unix_nano": 1764584197295107300, "events": [], "status": {"code": "STATUS_CODE_OK", "message": ""}, "attributes": {"mlflow.traceRequestId": "\"tr-258468cdd96bd5bf6c38f9089c05cc68\"", "mlflow.spanType": "\"CHAIN\"", "mlflow.spanInputs": "{\"messages\": [{\"content\": \"what is the capital of india\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"human\", \"name\": null, \"id\": null}, {\"content\": \"❌ 'what is the capital of india' is not about student data. Please ask about students/courses/enrollments only.\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}, {\"content\": \"how many students are there in the database\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"human\", \"name\": null, \"id\": null}, {\"content\": \"❌ 'how many students are there in the database' is not about student data. Please ask about students/courses/enrollments only.\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}, {\"content\": \"how many students\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"human\", \"name\": null, \"id\": null}, {\"content\": \"✅ Relevant: The question is about the number of students, which pertains to the students table.. Tables: students\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}, {\"content\": \"✅ Data available for tables: students\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}, {\"content\": \"Generated SQL (conf 1.00):\\nSELECT COUNT(*) AS total_students FROM students;\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}, {\"content\": \"what are the different cources  available\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"human\", \"name\": null, \"id\": null}], \"user_query\": \"how many students\", \"intent_result\": {\"is_relevant\": true, \"reason\": \"The question is about the number of students, which pertains to the students table.\", \"relevant_tables\": [\"students\"]}, \"data_check\": \"sufficient\", \"generated_sql\": \"SELECT COUNT(*) AS total_students FROM students;\", \"sql_attempts\": 1, \"sql_confidence\": 1.0}", "metadata": "{\"thread_id\": \"d2c030f9\", \"langgraph_step\": 13, \"langgraph_node\": \"check_intent\", \"langgraph_triggers\": [\"branch:to:check_intent\"], \"langgraph_path\": [\"__pregel_pull\", \"check_intent\"], \"langgraph_checkpoint_ns\": \"check_intent:582dfc7f-4671-34f9-bbaf-28955d68c481\"}", "mlflow.spanOutputs": "{\"messages\": [{\"content\": \"✅ Relevant: The question is about available courses, which relates to the courses table.. Tables: courses\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}], \"user_query\": \"what are the different cources  available\", \"intent_result\": {\"is_relevant\": true, \"reason\": \"The question is about available courses, which relates to the courses table.\", \"relevant_tables\": [\"courses\"]}}"}}, {"trace_id": "JYRozdlr1b9sOPkInAXMaA==", "span_id": "N4miBD41C0k=", "parent_span_id": "DcbekDcNDkY=", "name": "RunnableSequence", "start_time_unix_nano": 1764584195082240700, "end_time_unix_nano": 1764584197281141200, "events": [], "status": {"code": "STATUS_CODE_OK", "message": ""}, "attributes": {"mlflow.traceRequestId": "\"tr-258468cdd96bd5bf6c38f9089c05cc68\"", "mlflow.spanType": "\"CHAIN\"", "mlflow.spanInputs": "\"You are a SQL database assistant for STUDENT DOMAIN ONLY.\\n\\nAvailable tables: students, courses, enrollments\\n\\nVALID questions: \\n- Student GPA, names, cities\\n- Course departments, credits  \\n- Enrollment grades, semesters\\n\\nINVALID: Weather, sports, finance, politics, etc.\\n\\nRespond with structured JSON only.\\n\\nQuery: what are the different cources  available\"", "metadata": "{\"thread_id\": \"d2c030f9\", \"langgraph_step\": 13, \"langgraph_node\": \"check_intent\", \"langgraph_triggers\": [\"branch:to:check_intent\"], \"langgraph_path\": [\"__pregel_pull\", \"check_intent\"], \"langgraph_checkpoint_ns\": \"check_intent:582dfc7f-4671-34f9-bbaf-28955d68c481\", \"checkpoint_ns\": \"check_intent:582dfc7f-4671-34f9-bbaf-28955d68c481\"}", "mlflow.spanOutputs": "{\"is_relevant\": true, \"reason\": \"The question is about available courses, which relates to the courses table.\", \"relevant_tables\": [\"courses\"]}"}}, {"trace_id": "JYRozdlr1b9sOPkInAXMaA==", "span_id": "LUa/Q8hbM84=", "parent_span_id": "N4miBD41C0k=", "name": "ChatOpenAI", "start_time_unix_nano": 1764584195090975600, "end_time_unix_nano": 1764584197271011100, "events": [], "status": {"code": "STATUS_CODE_OK", "message": ""}, "attributes": {"mlflow.traceRequestId": "\"tr-258468cdd96bd5bf6c38f9089c05cc68\"", "mlflow.spanType": "\"CHAT_MODEL\"", "mlflow.spanInputs": "[[{\"content\": \"You are a SQL database assistant for STUDENT DOMAIN ONLY.\\n\\nAvailable tables: students, courses, enrollments\\n\\nVALID questions: \\n- Student GPA, names, cities\\n- Course departments, credits  \\n- Enrollment grades, semesters\\n\\nINVALID: Weather, sports, finance, politics, etc.\\n\\nRespond with structured JSON only.\\n\\nQuery: what are the different cources  available\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"human\", \"name\": null, \"id\": null}]]", "invocation_params": "{\"model\": \"gpt-4o-mini\", \"model_name\": \"gpt-4o-mini\", \"stream\": false, \"temperature\": 0.0, \"_type\": \"openai-chat\", \"stop\": null, \"response_format\": {\"description\": \"Structured output for intent validation.\", \"properties\": {\"is_relevant\": {\"description\": \"True if question is about students/courses/enrollments\", \"title\": \"Is Relevant\", \"type\": \"boolean\"}, \"reason\": {\"description\": \"Why relevant or not relevant\", \"title\": \"Reason\", \"type\": \"string\"}, \"relevant_tables\": {\"default\": [], \"description\": \"Relevant tables: ['students', 'courses']\", \"items\": {\"type\": \"string\"}, \"title\": \"Relevant Tables\", \"type\": \"array\"}}, \"required\": [\"is_relevant\", \"reason\"], \"title\": \"IntentCheck\", \"type\": \"object\"}}", "options": "{\"stop\": null, \"ls_structured_output_format\": {\"kwargs\": {\"method\": \"json_schema\", \"strict\": null}, \"schema\": {\"title\": \"IntentCheck\", \"description\": \"Structured output for intent validation.\", \"properties\": {\"is_relevant\": {\"description\": \"True if question is about students/courses/enrollments\", \"type\": \"boolean\"}, \"reason\": {\"description\": \"Why relevant or not relevant\", \"type\": \"string\"}, \"relevant_tables\": {\"default\": [], \"description\": \"Relevant tables: ['students', 'courses']\", \"items\": {\"type\": \"string\"}, \"type\": \"array\"}}, \"required\": [\"is_relevant\", \"reason\"], \"type\": \"object\"}}}", "batch_size": "1", "metadata": "{\"thread_id\": \"d2c030f9\", \"langgraph_step\": 13, \"langgraph_node\": \"check_intent\", \"langgraph_triggers\": [\"branch:to:check_intent\"], \"langgraph_path\": [\"__pregel_pull\", \"check_intent\"], \"langgraph_checkpoint_ns\": \"check_intent:582dfc7f-4671-34f9-bbaf-28955d68c481\", \"checkpoint_ns\": \"check_intent:582dfc7f-4671-34f9-bbaf-28955d68c481\", \"ls_provider\": \"openai\", \"ls_model_name\": \"gpt-4o-mini\", \"ls_model_type\": \"chat\", \"ls_temperature\": 0.0}", "mlflow.message.format": "\"langchain\"", "mlflow.chat.tokenUsage": "{\"input_tokens\": 197, \"output_tokens\": 30, \"total_tokens\": 227}", "mlflow.spanOutputs": "{\"generations\": [[{\"text\": \"{\\\"is_relevant\\\":true,\\\"reason\\\":\\\"The question is about available courses, which relates to the courses table.\\\",\\\"relevant_tables\\\":[\\\"courses\\\"]}\", \"generation_info\": {\"finish_reason\": \"stop\", \"logprobs\": null}, \"type\": \"ChatGeneration\", \"message\": {\"content\": \"{\\\"is_relevant\\\":true,\\\"reason\\\":\\\"The question is about available courses, which relates to the courses table.\\\",\\\"relevant_tables\\\":[\\\"courses\\\"]}\", \"additional_kwargs\": {\"parsed\": {\"is_relevant\": true, \"reason\": \"The question is about available courses, which relates to the courses table.\", \"relevant_tables\": [\"courses\"]}, \"refusal\": null}, \"response_metadata\": {\"token_usage\": {\"completion_tokens\": 30, \"prompt_tokens\": 197, \"total_tokens\": 227, \"completion_tokens_details\": {\"accepted_prediction_tokens\": 0, \"audio_tokens\": 0, \"reasoning_tokens\": 0, \"rejected_prediction_tokens\": 0}, \"prompt_tokens_details\": {\"audio_tokens\": 0, \"cached_tokens\": 0}}, \"model_provider\": \"openai\", \"model_name\": \"gpt-4o-mini-2024-07-18\", \"system_fingerprint\": \"fp_b547601dbd\", \"id\": \"chatcmpl-ChvFNqJp0kpaj30tMtzBBrO3mIypb\", \"service_tier\": \"default\", \"finish_reason\": \"stop\", \"logprobs\": null}, \"type\": \"ai\", \"name\": null, \"id\": \"lc_run--2db2486e-ca78-4d6b-ba55-dbdfaca142b7-0\"}}]], \"llm_output\": {\"token_usage\": {\"completion_tokens\": 30, \"prompt_tokens\": 197, \"total_tokens\": 227, \"completion_tokens_details\": {\"accepted_prediction_tokens\": 0, \"audio_tokens\": 0, \"reasoning_tokens\": 0, \"rejected_prediction_tokens\": 0}, \"prompt_tokens_details\": {\"audio_tokens\": 0, \"cached_tokens\": 0}}, \"model_provider\": \"openai\", \"model_name\": \"gpt-4o-mini-2024-07-18\", \"system_fingerprint\": \"fp_b547601dbd\", \"id\": \"chatcmpl-ChvFNqJp0kpaj30tMtzBBrO3mIypb\", \"service_tier\": \"default\"}, \"run\": null, \"type\": \"LLMResult\"}"}}, {"trace_id": "JYRozdlr1b9sOPkInAXMaA==", "span_id": "ZTnvioqTKS8=", "parent_span_id": "N4miBD41C0k=", "name": "RunnableLambda", "start_time_unix_nano": 1764584197281141200, "end_time_unix_nano": 1764584197281141200, "events": [], "status": {"code": "STATUS_CODE_OK", "message": ""}, "attributes": {"mlflow.traceRequestId": "\"tr-258468cdd96bd5bf6c38f9089c05cc68\"", "mlflow.spanType": "\"CHAIN\"", "mlflow.spanInputs": "{\"content\": \"{\\\"is_relevant\\\":true,\\\"reason\\\":\\\"The question is about available courses, which relates to the courses table.\\\",\\\"relevant_tables\\\":[\\\"courses\\\"]}\", \"additional_kwargs\": {\"parsed\": {\"is_relevant\": true, \"reason\": \"The question is about available courses, which relates to the courses table.\", \"relevant_tables\": [\"courses\"]}, \"refusal\": null}, \"response_metadata\": {\"token_usage\": {\"completion_tokens\": 30, \"prompt_tokens\": 197, \"total_tokens\": 227, \"completion_tokens_details\": {\"accepted_prediction_tokens\": 0, \"audio_tokens\": 0, \"reasoning_tokens\": 0, \"rejected_prediction_tokens\": 0}, \"prompt_tokens_details\": {\"audio_tokens\": 0, \"cached_tokens\": 0}}, \"model_provider\": \"openai\", \"model_name\": \"gpt-4o-mini-2024-07-18\", \"system_fingerprint\": \"fp_b547601dbd\", \"id\": \"chatcmpl-ChvFNqJp0kpaj30tMtzBBrO3mIypb\", \"service_tier\": \"default\", \"finish_reason\": \"stop\", \"logprobs\": null}, \"type\": \"ai\", \"name\": null, \"id\": \"lc_run--2db2486e-ca78-4d6b-ba55-dbdfaca142b7-0\", \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": {\"input_tokens\": 197, \"output_tokens\": 30, \"total_tokens\": 227, \"input_token_details\": {\"audio\": 0, \"cache_read\": 0}, \"output_token_details\": {\"audio\": 0, \"reasoning\": 0}}}", "metadata": "{\"thread_id\": \"d2c030f9\", \"langgraph_step\": 13, \"langgraph_node\": \"check_intent\", \"langgraph_triggers\": [\"branch:to:check_intent\"], \"langgraph_path\": [\"__pregel_pull\", \"check_intent\"], \"langgraph_checkpoint_ns\": \"check_intent:582dfc7f-4671-34f9-bbaf-28955d68c481\", \"checkpoint_ns\": \"check_intent:582dfc7f-4671-34f9-bbaf-28955d68c481\"}", "mlflow.spanOutputs": "{\"is_relevant\": true, \"reason\": \"The question is about available courses, which relates to the courses table.\", \"relevant_tables\": [\"courses\"]}"}}, {"trace_id": "JYRozdlr1b9sOPkInAXMaA==", "span_id": "E5EbxdSOo/I=", "parent_span_id": "DcbekDcNDkY=", "name": "route_intent", "start_time_unix_nano": 1764584197291761000, "end_time_unix_nano": 1764584197293744600, "events": [], "status": {"code": "STATUS_CODE_OK", "message": ""}, "attributes": {"mlflow.traceRequestId": "\"tr-258468cdd96bd5bf6c38f9089c05cc68\"", "mlflow.spanType": "\"CHAIN\"", "mlflow.spanInputs": "{\"messages\": [{\"content\": \"what is the capital of india\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"human\", \"name\": null, \"id\": null}, {\"content\": \"❌ 'what is the capital of india' is not about student data. Please ask about students/courses/enrollments only.\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}, {\"content\": \"how many students are there in the database\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"human\", \"name\": null, \"id\": null}, {\"content\": \"❌ 'how many students are there in the database' is not about student data. Please ask about students/courses/enrollments only.\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}, {\"content\": \"how many students\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"human\", \"name\": null, \"id\": null}, {\"content\": \"✅ Relevant: The question is about the number of students, which pertains to the students table.. Tables: students\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}, {\"content\": \"✅ Data available for tables: students\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}, {\"content\": \"Generated SQL (conf 1.00):\\nSELECT COUNT(*) AS total_students FROM students;\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}, {\"content\": \"what are the different cources  available\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"human\", \"name\": null, \"id\": null}, {\"content\": \"✅ Relevant: The question is about available courses, which relates to the courses table.. Tables: courses\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}], \"user_query\": \"what are the different cources  available\", \"intent_result\": {\"is_relevant\": true, \"reason\": \"The question is about available courses, which relates to the courses table.\", \"relevant_tables\": [\"courses\"]}, \"data_check\": \"sufficient\", \"generated_sql\": \"SELECT COUNT(*) AS total_students FROM students;\", \"sql_attempts\": 1, \"sql_confidence\": 1.0}", "metadata": "{\"thread_id\": \"d2c030f9\", \"langgraph_step\": 13, \"langgraph_node\": \"check_intent\", \"langgraph_triggers\": [\"branch:to:check_intent\"], \"langgraph_path\": [\"__pregel_pull\", \"check_intent\"], \"langgraph_checkpoint_ns\": \"check_intent:582dfc7f-4671-34f9-bbaf-28955d68c481\"}", "mlflow.spanOutputs": "\"check_data\""}}, {"trace_id": "JYRozdlr1b9sOPkInAXMaA==", "span_id": "18vRgfFD4c8=", "parent_span_id": "MuOCj/yM/I4=", "name": "check_data", "start_time_unix_nano": 1764584197300152900, "end_time_unix_nano": 1764584198533341400, "events": [], "status": {"code": "STATUS_CODE_OK", "message": ""}, "attributes": {"mlflow.traceRequestId": "\"tr-258468cdd96bd5bf6c38f9089c05cc68\"", "mlflow.spanType": "\"CHAIN\"", "mlflow.spanInputs": "{\"messages\": [{\"content\": \"what is the capital of india\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"human\", \"name\": null, \"id\": null}, {\"content\": \"❌ 'what is the capital of india' is not about student data. Please ask about students/courses/enrollments only.\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}, {\"content\": \"how many students are there in the database\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"human\", \"name\": null, \"id\": null}, {\"content\": \"❌ 'how many students are there in the database' is not about student data. Please ask about students/courses/enrollments only.\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}, {\"content\": \"how many students\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"human\", \"name\": null, \"id\": null}, {\"content\": \"✅ Relevant: The question is about the number of students, which pertains to the students table.. Tables: students\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}, {\"content\": \"✅ Data available for tables: students\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}, {\"content\": \"Generated SQL (conf 1.00):\\nSELECT COUNT(*) AS total_students FROM students;\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}, {\"content\": \"what are the different cources  available\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"human\", \"name\": null, \"id\": null}, {\"content\": \"✅ Relevant: The question is about available courses, which relates to the courses table.. Tables: courses\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}], \"user_query\": \"what are the different cources  available\", \"intent_result\": {\"is_relevant\": true, \"reason\": \"The question is about available courses, which relates to the courses table.\", \"relevant_tables\": [\"courses\"]}, \"data_check\": \"sufficient\", \"generated_sql\": \"SELECT COUNT(*) AS total_students FROM students;\", \"sql_attempts\": 1, \"sql_confidence\": 1.0}", "metadata": "{\"thread_id\": \"d2c030f9\", \"langgraph_step\": 14, \"langgraph_node\": \"check_data\", \"langgraph_triggers\": [\"branch:to:check_data\"], \"langgraph_path\": [\"__pregel_pull\", \"check_data\"], \"langgraph_checkpoint_ns\": \"check_data:f97b5345-ea65-dcee-1c91-2425d9d93027\"}", "mlflow.spanOutputs": "{\"messages\": [{\"content\": \"✅ Data available for tables: courses\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}], \"data_check\": \"sufficient\"}"}}, {"trace_id": "JYRozdlr1b9sOPkInAXMaA==", "span_id": "JDB87FTgYbY=", "parent_span_id": "18vRgfFD4c8=", "name": "RunnableSequence", "start_time_unix_nano": 1764584197304066400, "end_time_unix_nano": 1764584198515086500, "events": [], "status": {"code": "STATUS_CODE_OK", "message": ""}, "attributes": {"mlflow.traceRequestId": "\"tr-258468cdd96bd5bf6c38f9089c05cc68\"", "mlflow.spanType": "\"CHAIN\"", "mlflow.spanInputs": "\"Check if database has sufficient data for the question.\\n    Return structured result with clear reasoning.\\nTables needed: courses\"", "metadata": "{\"thread_id\": \"d2c030f9\", \"langgraph_step\": 14, \"langgraph_node\": \"check_data\", \"langgraph_triggers\": [\"branch:to:check_data\"], \"langgraph_path\": [\"__pregel_pull\", \"check_data\"], \"langgraph_checkpoint_ns\": \"check_data:f97b5345-ea65-dcee-1c91-2425d9d93027\", \"checkpoint_ns\": \"check_data:f97b5345-ea65-dcee-1c91-2425d9d93027\"}", "mlflow.spanOutputs": "{\"has_data\": true, \"missing_data\": \"\"}"}}, {"trace_id": "JYRozdlr1b9sOPkInAXMaA==", "span_id": "pIb83QDK3Xo=", "parent_span_id": "JDB87FTgYbY=", "name": "ChatOpenAI", "start_time_unix_nano": 1764584197315723600, "end_time_unix_nano": 1764584198497452500, "events": [], "status": {"code": "STATUS_CODE_OK", "message": ""}, "attributes": {"mlflow.traceRequestId": "\"tr-258468cdd96bd5bf6c38f9089c05cc68\"", "mlflow.spanType": "\"CHAT_MODEL\"", "mlflow.spanInputs": "[[{\"content\": \"Check if database has sufficient data for the question.\\n    Return structured result with clear reasoning.\\nTables needed: courses\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"human\", \"name\": null, \"id\": null}]]", "invocation_params": "{\"model\": \"gpt-4o-mini\", \"model_name\": \"gpt-4o-mini\", \"stream\": false, \"temperature\": 0.0, \"_type\": \"openai-chat\", \"stop\": null, \"response_format\": {\"description\": \"Check if DB has required data.\", \"properties\": {\"has_data\": {\"description\": \"True if DB has sufficient data\", \"title\": \"Has Data\", \"type\": \"boolean\"}, \"missing_data\": {\"description\": \"What data is missing\", \"title\": \"Missing Data\", \"type\": \"string\"}}, \"required\": [\"has_data\", \"missing_data\"], \"title\": \"DataAvailability\", \"type\": \"object\"}}", "options": "{\"stop\": null, \"ls_structured_output_format\": {\"kwargs\": {\"method\": \"json_schema\", \"strict\": null}, \"schema\": {\"title\": \"DataAvailability\", \"description\": \"Check if DB has required data.\", \"properties\": {\"has_data\": {\"description\": \"True if DB has sufficient data\", \"type\": \"boolean\"}, \"missing_data\": {\"description\": \"What data is missing\", \"type\": \"string\"}}, \"required\": [\"has_data\", \"missing_data\"], \"type\": \"object\"}}}", "batch_size": "1", "metadata": "{\"thread_id\": \"d2c030f9\", \"langgraph_step\": 14, \"langgraph_node\": \"check_data\", \"langgraph_triggers\": [\"branch:to:check_data\"], \"langgraph_path\": [\"__pregel_pull\", \"check_data\"], \"langgraph_checkpoint_ns\": \"check_data:f97b5345-ea65-dcee-1c91-2425d9d93027\", \"checkpoint_ns\": \"check_data:f97b5345-ea65-dcee-1c91-2425d9d93027\", \"ls_provider\": \"openai\", \"ls_model_name\": \"gpt-4o-mini\", \"ls_model_type\": \"chat\", \"ls_temperature\": 0.0}", "mlflow.message.format": "\"langchain\"", "mlflow.chat.tokenUsage": "{\"input_tokens\": 108, \"output_tokens\": 11, \"total_tokens\": 119}", "mlflow.spanOutputs": "{\"generations\": [[{\"text\": \"{\\\"has_data\\\":true,\\\"missing_data\\\":\\\"\\\"}\", \"generation_info\": {\"finish_reason\": \"stop\", \"logprobs\": null}, \"type\": \"ChatGeneration\", \"message\": {\"content\": \"{\\\"has_data\\\":true,\\\"missing_data\\\":\\\"\\\"}\", \"additional_kwargs\": {\"parsed\": {\"has_data\": true, \"missing_data\": \"\"}, \"refusal\": null}, \"response_metadata\": {\"token_usage\": {\"completion_tokens\": 11, \"prompt_tokens\": 108, \"total_tokens\": 119, \"completion_tokens_details\": {\"accepted_prediction_tokens\": 0, \"audio_tokens\": 0, \"reasoning_tokens\": 0, \"rejected_prediction_tokens\": 0}, \"prompt_tokens_details\": {\"audio_tokens\": 0, \"cached_tokens\": 0}}, \"model_provider\": \"openai\", \"model_name\": \"gpt-4o-mini-2024-07-18\", \"system_fingerprint\": \"fp_b547601dbd\", \"id\": \"chatcmpl-ChvFOTlmpLNPZla58WFzsmdQirjcj\", \"service_tier\": \"default\", \"finish_reason\": \"stop\", \"logprobs\": null}, \"type\": \"ai\", \"name\": null, \"id\": \"lc_run--8d2d4f6f-7894-47ac-a44b-f2a003a8348a-0\"}}]], \"llm_output\": {\"token_usage\": {\"completion_tokens\": 11, \"prompt_tokens\": 108, \"total_tokens\": 119, \"completion_tokens_details\": {\"accepted_prediction_tokens\": 0, \"audio_tokens\": 0, \"reasoning_tokens\": 0, \"rejected_prediction_tokens\": 0}, \"prompt_tokens_details\": {\"audio_tokens\": 0, \"cached_tokens\": 0}}, \"model_provider\": \"openai\", \"model_name\": \"gpt-4o-mini-2024-07-18\", \"system_fingerprint\": \"fp_b547601dbd\", \"id\": \"chatcmpl-ChvFOTlmpLNPZla58WFzsmdQirjcj\", \"service_tier\": \"default\"}, \"run\": null, \"type\": \"LLMResult\"}"}}, {"trace_id": "JYRozdlr1b9sOPkInAXMaA==", "span_id": "mDVHgv885g8=", "parent_span_id": "JDB87FTgYbY=", "name": "RunnableLambda", "start_time_unix_nano": 1764584198515086500, "end_time_unix_nano": 1764584198515086500, "events": [], "status": {"code": "STATUS_CODE_OK", "message": ""}, "attributes": {"mlflow.traceRequestId": "\"tr-258468cdd96bd5bf6c38f9089c05cc68\"", "mlflow.spanType": "\"CHAIN\"", "mlflow.spanInputs": "{\"content\": \"{\\\"has_data\\\":true,\\\"missing_data\\\":\\\"\\\"}\", \"additional_kwargs\": {\"parsed\": {\"has_data\": true, \"missing_data\": \"\"}, \"refusal\": null}, \"response_metadata\": {\"token_usage\": {\"completion_tokens\": 11, \"prompt_tokens\": 108, \"total_tokens\": 119, \"completion_tokens_details\": {\"accepted_prediction_tokens\": 0, \"audio_tokens\": 0, \"reasoning_tokens\": 0, \"rejected_prediction_tokens\": 0}, \"prompt_tokens_details\": {\"audio_tokens\": 0, \"cached_tokens\": 0}}, \"model_provider\": \"openai\", \"model_name\": \"gpt-4o-mini-2024-07-18\", \"system_fingerprint\": \"fp_b547601dbd\", \"id\": \"chatcmpl-ChvFOTlmpLNPZla58WFzsmdQirjcj\", \"service_tier\": \"default\", \"finish_reason\": \"stop\", \"logprobs\": null}, \"type\": \"ai\", \"name\": null, \"id\": \"lc_run--8d2d4f6f-7894-47ac-a44b-f2a003a8348a-0\", \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": {\"input_tokens\": 108, \"output_tokens\": 11, \"total_tokens\": 119, \"input_token_details\": {\"audio\": 0, \"cache_read\": 0}, \"output_token_details\": {\"audio\": 0, \"reasoning\": 0}}}", "metadata": "{\"thread_id\": \"d2c030f9\", \"langgraph_step\": 14, \"langgraph_node\": \"check_data\", \"langgraph_triggers\": [\"branch:to:check_data\"], \"langgraph_path\": [\"__pregel_pull\", \"check_data\"], \"langgraph_checkpoint_ns\": \"check_data:f97b5345-ea65-dcee-1c91-2425d9d93027\", \"checkpoint_ns\": \"check_data:f97b5345-ea65-dcee-1c91-2425d9d93027\"}", "mlflow.spanOutputs": "{\"has_data\": true, \"missing_data\": \"\"}"}}, {"trace_id": "JYRozdlr1b9sOPkInAXMaA==", "span_id": "dsWNKzs5/L8=", "parent_span_id": "18vRgfFD4c8=", "name": "route_data_check", "start_time_unix_nano": 1764584198526469800, "end_time_unix_nano": 1764584198531865600, "events": [], "status": {"code": "STATUS_CODE_OK", "message": ""}, "attributes": {"mlflow.traceRequestId": "\"tr-258468cdd96bd5bf6c38f9089c05cc68\"", "mlflow.spanType": "\"CHAIN\"", "mlflow.spanInputs": "{\"messages\": [{\"content\": \"what is the capital of india\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"human\", \"name\": null, \"id\": null}, {\"content\": \"❌ 'what is the capital of india' is not about student data. Please ask about students/courses/enrollments only.\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}, {\"content\": \"how many students are there in the database\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"human\", \"name\": null, \"id\": null}, {\"content\": \"❌ 'how many students are there in the database' is not about student data. Please ask about students/courses/enrollments only.\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}, {\"content\": \"how many students\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"human\", \"name\": null, \"id\": null}, {\"content\": \"✅ Relevant: The question is about the number of students, which pertains to the students table.. Tables: students\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}, {\"content\": \"✅ Data available for tables: students\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}, {\"content\": \"Generated SQL (conf 1.00):\\nSELECT COUNT(*) AS total_students FROM students;\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}, {\"content\": \"what are the different cources  available\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"human\", \"name\": null, \"id\": null}, {\"content\": \"✅ Relevant: The question is about available courses, which relates to the courses table.. Tables: courses\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}, {\"content\": \"✅ Data available for tables: courses\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}], \"user_query\": \"what are the different cources  available\", \"intent_result\": {\"is_relevant\": true, \"reason\": \"The question is about available courses, which relates to the courses table.\", \"relevant_tables\": [\"courses\"]}, \"data_check\": \"sufficient\", \"generated_sql\": \"SELECT COUNT(*) AS total_students FROM students;\", \"sql_attempts\": 1, \"sql_confidence\": 1.0}", "metadata": "{\"thread_id\": \"d2c030f9\", \"langgraph_step\": 14, \"langgraph_node\": \"check_data\", \"langgraph_triggers\": [\"branch:to:check_data\"], \"langgraph_path\": [\"__pregel_pull\", \"check_data\"], \"langgraph_checkpoint_ns\": \"check_data:f97b5345-ea65-dcee-1c91-2425d9d93027\"}", "mlflow.spanOutputs": "\"generate_sql\""}}, {"trace_id": "JYRozdlr1b9sOPkInAXMaA==", "span_id": "LXYaIVwIh6Q=", "parent_span_id": "MuOCj/yM/I4=", "name": "generate_sql", "start_time_unix_nano": 1764584198540986900, "end_time_unix_nano": 1764584199765757100, "events": [], "status": {"code": "STATUS_CODE_OK", "message": ""}, "attributes": {"mlflow.traceRequestId": "\"tr-258468cdd96bd5bf6c38f9089c05cc68\"", "mlflow.spanType": "\"CHAIN\"", "mlflow.spanInputs": "{\"messages\": [{\"content\": \"what is the capital of india\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"human\", \"name\": null, \"id\": null}, {\"content\": \"❌ 'what is the capital of india' is not about student data. Please ask about students/courses/enrollments only.\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}, {\"content\": \"how many students are there in the database\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"human\", \"name\": null, \"id\": null}, {\"content\": \"❌ 'how many students are there in the database' is not about student data. Please ask about students/courses/enrollments only.\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}, {\"content\": \"how many students\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"human\", \"name\": null, \"id\": null}, {\"content\": \"✅ Relevant: The question is about the number of students, which pertains to the students table.. Tables: students\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}, {\"content\": \"✅ Data available for tables: students\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}, {\"content\": \"Generated SQL (conf 1.00):\\nSELECT COUNT(*) AS total_students FROM students;\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}, {\"content\": \"what are the different cources  available\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"human\", \"name\": null, \"id\": null}, {\"content\": \"✅ Relevant: The question is about available courses, which relates to the courses table.. Tables: courses\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}, {\"content\": \"✅ Data available for tables: courses\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}], \"user_query\": \"what are the different cources  available\", \"intent_result\": {\"is_relevant\": true, \"reason\": \"The question is about available courses, which relates to the courses table.\", \"relevant_tables\": [\"courses\"]}, \"data_check\": \"sufficient\", \"generated_sql\": \"SELECT COUNT(*) AS total_students FROM students;\", \"sql_attempts\": 1, \"sql_confidence\": 1.0}", "metadata": "{\"thread_id\": \"d2c030f9\", \"langgraph_step\": 15, \"langgraph_node\": \"generate_sql\", \"langgraph_triggers\": [\"branch:to:generate_sql\"], \"langgraph_path\": [\"__pregel_pull\", \"generate_sql\"], \"langgraph_checkpoint_ns\": \"generate_sql:51d2bb6c-072a-aa3d-5393-644e1af5ecbb\"}", "mlflow.spanOutputs": "{\"generated_sql\": \"SELECT DISTINCT course_name FROM courses;\", \"sql_confidence\": 0.95, \"sql_attempts\": 2, \"messages\": [{\"content\": \"Generated SQL (conf 0.95):\\nSELECT DISTINCT course_name FROM courses;\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}]}"}}, {"trace_id": "JYRozdlr1b9sOPkInAXMaA==", "span_id": "ZHIL3mPOOSk=", "parent_span_id": "LXYaIVwIh6Q=", "name": "RunnableSequence", "start_time_unix_nano": 1764584198552184600, "end_time_unix_nano": 1764584199751666400, "events": [], "status": {"code": "STATUS_CODE_OK", "message": ""}, "attributes": {"mlflow.traceRequestId": "\"tr-258468cdd96bd5bf6c38f9089c05cc68\"", "mlflow.spanType": "\"CHAIN\"", "mlflow.spanInputs": "\"You are an expert SQL engineer. Generate SAFE SELECT queries ONLY.\\n\\nRules:\\n1. SELECT queries only - NO INSERT/UPDATE/DELETE\\n2. Use table schema provided\\n3. Handle edge cases (empty results, multiple tables)\\n4. High confidence queries only\\n\\nSchema: \\nCREATE TABLE courses (\\n\\tcourse_id TEXT, \\n\\tcourse_name TEXT, \\n\\tcredits INTEGER, \\n\\tdepartment TEXT\\n)\\n\\n/*\\n3 rows from courses table:\\ncourse_id\\tcourse_name\\tcredits\\tdepartment\\nC000\\tOpen 420\\t4\\tEnglish\\nC001\\tInterview 373\\t4\\tScience\\nC002\\tLate 290\\t3\\tEnglish\\n*/\\n\\nQuestion: what are the different cources  available\\n\\nReturn structured SQL with confidence score.\"", "metadata": "{\"thread_id\": \"d2c030f9\", \"langgraph_step\": 15, \"langgraph_node\": \"generate_sql\", \"langgraph_triggers\": [\"branch:to:generate_sql\"], \"langgraph_path\": [\"__pregel_pull\", \"generate_sql\"], \"langgraph_checkpoint_ns\": \"generate_sql:51d2bb6c-072a-aa3d-5393-644e1af5ecbb\", \"checkpoint_ns\": \"generate_sql:51d2bb6c-072a-aa3d-5393-644e1af5ecbb\"}", "mlflow.spanOutputs": "{\"sql_query\": \"SELECT DISTINCT course_name FROM courses;\", \"confidence\": 0.95, \"tables_used\": [\"courses\"]}"}}, {"trace_id": "JYRozdlr1b9sOPkInAXMaA==", "span_id": "52iW2AU74vg=", "parent_span_id": "ZHIL3mPOOSk=", "name": "ChatOpenAI", "start_time_unix_nano": 1764584198573483700, "end_time_unix_nano": 1764584199726412200, "events": [], "status": {"code": "STATUS_CODE_OK", "message": ""}, "attributes": {"mlflow.traceRequestId": "\"tr-258468cdd96bd5bf6c38f9089c05cc68\"", "mlflow.spanType": "\"CHAT_MODEL\"", "mlflow.spanInputs": "[[{\"content\": \"You are an expert SQL engineer. Generate SAFE SELECT queries ONLY.\\n\\nRules:\\n1. SELECT queries only - NO INSERT/UPDATE/DELETE\\n2. Use table schema provided\\n3. Handle edge cases (empty results, multiple tables)\\n4. High confidence queries only\\n\\nSchema: \\nCREATE TABLE courses (\\n\\tcourse_id TEXT, \\n\\tcourse_name TEXT, \\n\\tcredits INTEGER, \\n\\tdepartment TEXT\\n)\\n\\n/*\\n3 rows from courses table:\\ncourse_id\\tcourse_name\\tcredits\\tdepartment\\nC000\\tOpen 420\\t4\\tEnglish\\nC001\\tInterview 373\\t4\\tScience\\nC002\\tLate 290\\t3\\tEnglish\\n*/\\n\\nQuestion: what are the different cources  available\\n\\nReturn structured SQL with confidence score.\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"human\", \"name\": null, \"id\": null}]]", "invocation_params": "{\"model\": \"gpt-4o-mini\", \"model_name\": \"gpt-4o-mini\", \"stream\": false, \"temperature\": 0.0, \"_type\": \"openai-chat\", \"stop\": null, \"response_format\": {\"description\": \"Valid SQL query structure.\", \"properties\": {\"sql_query\": {\"description\": \"SAFE SELECT query only\", \"title\": \"Sql Query\", \"type\": \"string\"}, \"confidence\": {\"description\": \"0.0-1.0 confidence in query correctness\", \"title\": \"Confidence\", \"type\": \"number\"}, \"tables_used\": {\"description\": \"Tables referenced in query\", \"items\": {\"type\": \"string\"}, \"title\": \"Tables Used\", \"type\": \"array\"}}, \"required\": [\"sql_query\", \"confidence\", \"tables_used\"], \"title\": \"SQLQuery\", \"type\": \"object\"}}", "options": "{\"stop\": null, \"ls_structured_output_format\": {\"kwargs\": {\"method\": \"json_schema\", \"strict\": null}, \"schema\": {\"title\": \"SQLQuery\", \"description\": \"Valid SQL query structure.\", \"properties\": {\"sql_query\": {\"description\": \"SAFE SELECT query only\", \"type\": \"string\"}, \"confidence\": {\"description\": \"0.0-1.0 confidence in query correctness\", \"type\": \"number\"}, \"tables_used\": {\"description\": \"Tables referenced in query\", \"items\": {\"type\": \"string\"}, \"type\": \"array\"}}, \"required\": [\"sql_query\", \"confidence\", \"tables_used\"], \"type\": \"object\"}}}", "batch_size": "1", "metadata": "{\"thread_id\": \"d2c030f9\", \"langgraph_step\": 15, \"langgraph_node\": \"generate_sql\", \"langgraph_triggers\": [\"branch:to:generate_sql\"], \"langgraph_path\": [\"__pregel_pull\", \"generate_sql\"], \"langgraph_checkpoint_ns\": \"generate_sql:51d2bb6c-072a-aa3d-5393-644e1af5ecbb\", \"checkpoint_ns\": \"generate_sql:51d2bb6c-072a-aa3d-5393-644e1af5ecbb\", \"ls_provider\": \"openai\", \"ls_model_name\": \"gpt-4o-mini\", \"ls_model_type\": \"chat\", \"ls_temperature\": 0.0}", "mlflow.message.format": "\"langchain\"", "mlflow.chat.tokenUsage": "{\"input_tokens\": 266, \"output_tokens\": 24, \"total_tokens\": 290}", "mlflow.spanOutputs": "{\"generations\": [[{\"text\": \"{\\\"sql_query\\\":\\\"SELECT DISTINCT course_name FROM courses;\\\",\\\"confidence\\\":0.95,\\\"tables_used\\\":[\\\"courses\\\"]}\", \"generation_info\": {\"finish_reason\": \"stop\", \"logprobs\": null}, \"type\": \"ChatGeneration\", \"message\": {\"content\": \"{\\\"sql_query\\\":\\\"SELECT DISTINCT course_name FROM courses;\\\",\\\"confidence\\\":0.95,\\\"tables_used\\\":[\\\"courses\\\"]}\", \"additional_kwargs\": {\"parsed\": {\"sql_query\": \"SELECT DISTINCT course_name FROM courses;\", \"confidence\": 0.95, \"tables_used\": [\"courses\"]}, \"refusal\": null}, \"response_metadata\": {\"token_usage\": {\"completion_tokens\": 24, \"prompt_tokens\": 266, \"total_tokens\": 290, \"completion_tokens_details\": {\"accepted_prediction_tokens\": 0, \"audio_tokens\": 0, \"reasoning_tokens\": 0, \"rejected_prediction_tokens\": 0}, \"prompt_tokens_details\": {\"audio_tokens\": 0, \"cached_tokens\": 0}}, \"model_provider\": \"openai\", \"model_name\": \"gpt-4o-mini-2024-07-18\", \"system_fingerprint\": \"fp_b547601dbd\", \"id\": \"chatcmpl-ChvFPXHzQq3sxfjOlvKvwey5OMMr5\", \"service_tier\": \"default\", \"finish_reason\": \"stop\", \"logprobs\": null}, \"type\": \"ai\", \"name\": null, \"id\": \"lc_run--98c8b952-5d02-4bd5-b0ad-cb94dde9b94d-0\"}}]], \"llm_output\": {\"token_usage\": {\"completion_tokens\": 24, \"prompt_tokens\": 266, \"total_tokens\": 290, \"completion_tokens_details\": {\"accepted_prediction_tokens\": 0, \"audio_tokens\": 0, \"reasoning_tokens\": 0, \"rejected_prediction_tokens\": 0}, \"prompt_tokens_details\": {\"audio_tokens\": 0, \"cached_tokens\": 0}}, \"model_provider\": \"openai\", \"model_name\": \"gpt-4o-mini-2024-07-18\", \"system_fingerprint\": \"fp_b547601dbd\", \"id\": \"chatcmpl-ChvFPXHzQq3sxfjOlvKvwey5OMMr5\", \"service_tier\": \"default\"}, \"run\": null, \"type\": \"LLMResult\"}"}}, {"trace_id": "JYRozdlr1b9sOPkInAXMaA==", "span_id": "3PrbfSavg3I=", "parent_span_id": "ZHIL3mPOOSk=", "name": "RunnableLambda", "start_time_unix_nano": 1764584199745060900, "end_time_unix_nano": 1764584199751666400, "events": [], "status": {"code": "STATUS_CODE_OK", "message": ""}, "attributes": {"mlflow.traceRequestId": "\"tr-258468cdd96bd5bf6c38f9089c05cc68\"", "mlflow.spanType": "\"CHAIN\"", "mlflow.spanInputs": "{\"content\": \"{\\\"sql_query\\\":\\\"SELECT DISTINCT course_name FROM courses;\\\",\\\"confidence\\\":0.95,\\\"tables_used\\\":[\\\"courses\\\"]}\", \"additional_kwargs\": {\"parsed\": {\"sql_query\": \"SELECT DISTINCT course_name FROM courses;\", \"confidence\": 0.95, \"tables_used\": [\"courses\"]}, \"refusal\": null}, \"response_metadata\": {\"token_usage\": {\"completion_tokens\": 24, \"prompt_tokens\": 266, \"total_tokens\": 290, \"completion_tokens_details\": {\"accepted_prediction_tokens\": 0, \"audio_tokens\": 0, \"reasoning_tokens\": 0, \"rejected_prediction_tokens\": 0}, \"prompt_tokens_details\": {\"audio_tokens\": 0, \"cached_tokens\": 0}}, \"model_provider\": \"openai\", \"model_name\": \"gpt-4o-mini-2024-07-18\", \"system_fingerprint\": \"fp_b547601dbd\", \"id\": \"chatcmpl-ChvFPXHzQq3sxfjOlvKvwey5OMMr5\", \"service_tier\": \"default\", \"finish_reason\": \"stop\", \"logprobs\": null}, \"type\": \"ai\", \"name\": null, \"id\": \"lc_run--98c8b952-5d02-4bd5-b0ad-cb94dde9b94d-0\", \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": {\"input_tokens\": 266, \"output_tokens\": 24, \"total_tokens\": 290, \"input_token_details\": {\"audio\": 0, \"cache_read\": 0}, \"output_token_details\": {\"audio\": 0, \"reasoning\": 0}}}", "metadata": "{\"thread_id\": \"d2c030f9\", \"langgraph_step\": 15, \"langgraph_node\": \"generate_sql\", \"langgraph_triggers\": [\"branch:to:generate_sql\"], \"langgraph_path\": [\"__pregel_pull\", \"generate_sql\"], \"langgraph_checkpoint_ns\": \"generate_sql:51d2bb6c-072a-aa3d-5393-644e1af5ecbb\", \"checkpoint_ns\": \"generate_sql:51d2bb6c-072a-aa3d-5393-644e1af5ecbb\"}", "mlflow.spanOutputs": "{\"sql_query\": \"SELECT DISTINCT course_name FROM courses;\", \"confidence\": 0.95, \"tables_used\": [\"courses\"]}"}}, {"trace_id": "JYRozdlr1b9sOPkInAXMaA==", "span_id": "8rjPJvmAJaA=", "parent_span_id": "LXYaIVwIh6Q=", "name": "route_sql_validation", "start_time_unix_nano": 1764584199758623000, "end_time_unix_nano": 1764584199765757100, "events": [], "status": {"code": "STATUS_CODE_OK", "message": ""}, "attributes": {"mlflow.traceRequestId": "\"tr-258468cdd96bd5bf6c38f9089c05cc68\"", "mlflow.spanType": "\"CHAIN\"", "mlflow.spanInputs": "{\"messages\": [{\"content\": \"what is the capital of india\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"human\", \"name\": null, \"id\": null}, {\"content\": \"❌ 'what is the capital of india' is not about student data. Please ask about students/courses/enrollments only.\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}, {\"content\": \"how many students are there in the database\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"human\", \"name\": null, \"id\": null}, {\"content\": \"❌ 'how many students are there in the database' is not about student data. Please ask about students/courses/enrollments only.\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}, {\"content\": \"how many students\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"human\", \"name\": null, \"id\": null}, {\"content\": \"✅ Relevant: The question is about the number of students, which pertains to the students table.. Tables: students\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}, {\"content\": \"✅ Data available for tables: students\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}, {\"content\": \"Generated SQL (conf 1.00):\\nSELECT COUNT(*) AS total_students FROM students;\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}, {\"content\": \"what are the different cources  available\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"human\", \"name\": null, \"id\": null}, {\"content\": \"✅ Relevant: The question is about available courses, which relates to the courses table.. Tables: courses\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}, {\"content\": \"✅ Data available for tables: courses\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}, {\"content\": \"Generated SQL (conf 0.95):\\nSELECT DISTINCT course_name FROM courses;\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}], \"user_query\": \"what are the different cources  available\", \"intent_result\": {\"is_relevant\": true, \"reason\": \"The question is about available courses, which relates to the courses table.\", \"relevant_tables\": [\"courses\"]}, \"data_check\": \"sufficient\", \"generated_sql\": \"SELECT DISTINCT course_name FROM courses;\", \"sql_attempts\": 2, \"sql_confidence\": 0.95}", "metadata": "{\"thread_id\": \"d2c030f9\", \"langgraph_step\": 15, \"langgraph_node\": \"generate_sql\", \"langgraph_triggers\": [\"branch:to:generate_sql\"], \"langgraph_path\": [\"__pregel_pull\", \"generate_sql\"], \"langgraph_checkpoint_ns\": \"generate_sql:51d2bb6c-072a-aa3d-5393-644e1af5ecbb\"}", "mlflow.spanOutputs": "\"execute_sql\""}}, {"trace_id": "JYRozdlr1b9sOPkInAXMaA==", "span_id": "az1bCghXzl0=", "parent_span_id": "MuOCj/yM/I4=", "name": "execute_sql", "start_time_unix_nano": 1764584199780066300, "end_time_unix_nano": 1764584199782553300, "events": [], "status": {"code": "STATUS_CODE_OK", "message": ""}, "attributes": {"mlflow.traceRequestId": "\"tr-258468cdd96bd5bf6c38f9089c05cc68\"", "mlflow.spanType": "\"CHAIN\"", "mlflow.spanInputs": "{\"messages\": [{\"content\": \"what is the capital of india\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"human\", \"name\": null, \"id\": null}, {\"content\": \"❌ 'what is the capital of india' is not about student data. Please ask about students/courses/enrollments only.\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}, {\"content\": \"how many students are there in the database\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"human\", \"name\": null, \"id\": null}, {\"content\": \"❌ 'how many students are there in the database' is not about student data. Please ask about students/courses/enrollments only.\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}, {\"content\": \"how many students\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"human\", \"name\": null, \"id\": null}, {\"content\": \"✅ Relevant: The question is about the number of students, which pertains to the students table.. Tables: students\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}, {\"content\": \"✅ Data available for tables: students\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}, {\"content\": \"Generated SQL (conf 1.00):\\nSELECT COUNT(*) AS total_students FROM students;\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}, {\"content\": \"what are the different cources  available\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"human\", \"name\": null, \"id\": null}, {\"content\": \"✅ Relevant: The question is about available courses, which relates to the courses table.. Tables: courses\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}, {\"content\": \"✅ Data available for tables: courses\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}, {\"content\": \"Generated SQL (conf 0.95):\\nSELECT DISTINCT course_name FROM courses;\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}], \"user_query\": \"what are the different cources  available\", \"intent_result\": {\"is_relevant\": true, \"reason\": \"The question is about available courses, which relates to the courses table.\", \"relevant_tables\": [\"courses\"]}, \"data_check\": \"sufficient\", \"generated_sql\": \"SELECT DISTINCT course_name FROM courses;\", \"sql_attempts\": 2, \"sql_confidence\": 0.95}", "metadata": "{\"thread_id\": \"d2c030f9\", \"langgraph_step\": 16, \"langgraph_node\": \"execute_sql\", \"langgraph_triggers\": [\"branch:to:execute_sql\"], \"langgraph_path\": [\"__pregel_pull\", \"execute_sql\"], \"langgraph_checkpoint_ns\": \"execute_sql:036e4abd-da34-2803-b6df-c587084da285\"}", "mlflow.spanOutputs": "{\"messages\": []}"}}, {"trace_id": "JYRozdlr1b9sOPkInAXMaA==", "span_id": "XQOfyaTw/3Y=", "parent_span_id": "MuOCj/yM/I4=", "name": "format_answer", "start_time_unix_nano": 1764584199793226900, "end_time_unix_nano": 1764584199805136100, "events": [{"name": "exception", "time_unix_nano": 1764584199805136, "attributes": {"exception.message": "'query_result'", "exception.type": "KeyError", "exception.stacktrace": "Traceback (most recent call last):\n  File \"c:\\Users\\HP\\anaconda3\\envs\\NLQ_TO_PYTHON_CHATBOT_ENV\\Lib\\site-packages\\langgraph\\_internal\\_runnable.py\", line 656, in invoke\n    input = context.run(step.invoke, input, config, **kwargs)\n            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"c:\\Users\\HP\\anaconda3\\envs\\NLQ_TO_PYTHON_CHATBOT_ENV\\Lib\\site-packages\\langgraph\\_internal\\_runnable.py\", line 400, in invoke\n    ret = self.func(*args, **kwargs)\n          ^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"C:\\Users\\HP\\AppData\\Local\\Temp\\ipykernel_13412\\2051451323.py\", line 5, in format_final_answer\n    result = state['query_result']\n             ~~~~~^^^^^^^^^^^^^^^^\nKeyError: 'query_result'"}}], "status": {"code": "STATUS_CODE_ERROR", "message": "'query_result'"}, "attributes": {"mlflow.traceRequestId": "\"tr-258468cdd96bd5bf6c38f9089c05cc68\"", "mlflow.spanType": "\"CHAIN\"", "mlflow.spanInputs": "{\"messages\": [{\"content\": \"what is the capital of india\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"human\", \"name\": null, \"id\": null}, {\"content\": \"❌ 'what is the capital of india' is not about student data. Please ask about students/courses/enrollments only.\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}, {\"content\": \"how many students are there in the database\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"human\", \"name\": null, \"id\": null}, {\"content\": \"❌ 'how many students are there in the database' is not about student data. Please ask about students/courses/enrollments only.\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}, {\"content\": \"how many students\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"human\", \"name\": null, \"id\": null}, {\"content\": \"✅ Relevant: The question is about the number of students, which pertains to the students table.. Tables: students\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}, {\"content\": \"✅ Data available for tables: students\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}, {\"content\": \"Generated SQL (conf 1.00):\\nSELECT COUNT(*) AS total_students FROM students;\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}, {\"content\": \"what are the different cources  available\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"human\", \"name\": null, \"id\": null}, {\"content\": \"✅ Relevant: The question is about available courses, which relates to the courses table.. Tables: courses\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}, {\"content\": \"✅ Data available for tables: courses\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}, {\"content\": \"Generated SQL (conf 0.95):\\nSELECT DISTINCT course_name FROM courses;\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}], \"user_query\": \"what are the different cources  available\", \"intent_result\": {\"is_relevant\": true, \"reason\": \"The question is about available courses, which relates to the courses table.\", \"relevant_tables\": [\"courses\"]}, \"data_check\": \"sufficient\", \"generated_sql\": \"SELECT DISTINCT course_name FROM courses;\", \"sql_attempts\": 2, \"sql_confidence\": 0.95}", "metadata": "{\"thread_id\": \"d2c030f9\", \"langgraph_step\": 17, \"langgraph_node\": \"format_answer\", \"langgraph_triggers\": [\"branch:to:format_answer\"], \"langgraph_path\": [\"__pregel_pull\", \"format_answer\"], \"langgraph_checkpoint_ns\": \"format_answer:5b977954-c762-cd4e-af5a-660655e366d8\"}"}}]}